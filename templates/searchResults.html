{% extends "layout.html" %} {% block title %} Flight Results {% endblock %} {%
block section %}

{% block script %} 
  <script type="text/javascript" src="/static/searchResults.js" async></script>
{% endblock %} 

<div class="results-header">
  <div class="details">{{ city_from }}</div>
  <svg class="header-airplane">
    <use xlink:href="#airplane"></use>
  </svg>
  <div class="details">{{ city_to }}</div>
  <svg
    class="header-calendar"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="none"
    stroke="#000000"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
    <line x1="16" y1="2" x2="16" y2="6"></line>
    <line x1="8" y1="2" x2="8" y2="6"></line>
    <line x1="3" y1="10" x2="21" y2="10"></line>
  </svg>
  <div class="details date">{{ departing }} 
    {% if returning is not none %}
     - {{ returning }}
    {% endif %} 
  </div>
</div>


{% for itinerary in itineraryIds %}

  {% if flight_type == "roundtrip" %}
    {% set leg1, leg2 = itinerary.split("|") %}
  {% else %}
    {% set leg1 = itinerary %}
  {% endif %}

{% set leg1_info = search_results["legs"][leg1] %} 
{% set leg2_info = search_results["legs"][leg2] %} 


<div class="results-section">
  <div class="tags">
    <div class="type-tag">
      <h1>{% if passengers == 1 %}
          1 Adult,&nbsp
          {% else %}
          {{ passengers }} Passengers,&nbsp
          {% endif %}
          {{ cabin_class }}
      </h1>
    </div>
    <div class="price-tag">
      <h1>{{ search_results['itineraries'][itinerary]["pricingOptions"][0]['price']['amount'] }}</h1>
    </div>
  </div>

  <div class="flight-info">
    <div class="tpd-plan">
      <div class="tp-flight-plan">
        <div class="container-fluid">
          <div class="crop depart">
            <div
              class="context collapsed"
              data-bs-toggle="collapse"
              data-bs-target="#demo{{ loop.index }}"
            >
            {% if flight_type == "one-way" %}
              <a role="button" tabindex="0" class="tog-cal itin-det-btn">
                <i class="bi bi-chevron-up"></i>
                <i class="bi bi-chevron-down"></i>
              </a>
            {% endif %}  
            
              <div class="item it-2">
                <div class="dr-row">
                  <span class="al-name">
                    {% for carrie in leg1_info["operatingCarrierIds"] %}
                    {{ search_results['carriers'][carrie]['name'] }}{% if not loop.last %} +{% endif %}
                    {% endfor %}
                  </span>
                  {% set depart_arrives_in = leg1_info['arrivalDateTime']|date_hours %}
                  <div class="take-tim"><strong>Arrives: </strong>{{ depart_arrives_in.strftime('%A, %b %d, %Y') }}</div>
                 </div>
              </div>
              <div class="item it-1">
                <div class="route-dot">
                  {% set leg1_stops = (leg1_info['segmentIds']|length) - 1 %}
                  {% for i in range(leg1_stops) %}
                  <span class="point"></span>
                  {% endfor %}
                </div>
                <div class="airline-image">
                  <div class="df-text">{{ leg1_info['durationInMinutes']|to_hours }}</div>
                  <span class="img-wrapper">
                    <svg class="anime-airplane">
                      <use xlink:href="#airplane"></use>
                    </svg>
                    <span class="top-label has-stops"
                      >{% if leg1_stops == 0 %}
                      Direct flight
                      {% elif leg1_stops == 1 %}
                      1 Stop
                      {% else %}
                      {{ leg1_stops }} Stops
                      {% endif %}
                      <span class="stops">{% for segment in leg1_info['segmentIds'][0:-1] %}
                        {{ search_results['places'][search_results['segments'][segment]['destinationPlaceId']]['iata'] }}{% if not loop.last %},{% endif %}
                        {% endfor %}</span>
                    </span>
              
                    <span class="change-airport"><span>&#9888;</span> Airport change</span>
                  </span>
                </div>

                <div class="port-seg">
                  <div class="flight-seg origin">
                    {% set depart_leaves_in = leg1_info['departureDateTime']|date_hours %}
                    <div class="time">{{ depart_leaves_in.strftime('%I:%M %p') }}</div>
                    <div class="port">{{ search_results['places'][leg1_info['originPlaceId']]['iata'] }}</div>
                    <div class="name">{{ search_results['places'][leg1_info['originPlaceId']]['name'] }}</div>
                  </div>
                  <div class="flight-seg destination">
                    <div class="time plus">{{ depart_arrives_in.strftime('%I:%M %p') }}
                      {% set days = days_difference(leg1_info['departureDateTime']|date, leg1_info['arrivalDateTime']|date ) %}
                      <span>
                      {% if days > 0 %}
                      +{{ days }}
                      {% elif days < 0 %}
                      {{ days }}
                      {% endif %}
                      </span>
                    </div>
                    <div class="port">{{ search_results['places'][leg1_info['destinationPlaceId']]['iata'] }}</div>
                    <div class="name">{{ search_results['places'][leg1_info['destinationPlaceId']]['name'] }}</div>
                  </div>
                </div>
              </div>
            </div>

           
            <div id="demo{{ loop.index }}" class="fly-wrap collapse">
                
                {% for segment in leg1_info['segmentIds'] %}
                {% set depart_segment_info = search_results['segments'][segment] %}

                {% if not loop.first %}

                <div class="delay-frame">
  
                  <div class="welc"><i class="bi bi-clock"></i>Layover {{ hours_difference(search_results['segments'][leg1_info['segmentIds'][loop.index0 - 1]]['arrivalDateTime']|date_hours, depart_segment_info['departureDateTime']|date_hours) }}</div>
                </div>
  
                {% endif %}
                
              
                <div class="fly-det">
                <div class="f-item">
                  <div class="airway-title">
                    <img
                      class="airline-logo"
                      src="{{ search_results['carriers'][depart_segment_info['operatingCarrierId']]['imageUrl'] }}" onError="this.onerror=null;this.src='';this.parentElement.innerText='{{ search_results['carriers'][depart_segment_info['operatingCarrierId']]['name'] }}';"
                    />
                  </div>
                  <div class="root-de">
                    <div class="times">{{ depart_segment_info['durationInMinutes']|to_hours }}</div>
                    <div class="directs">
                      <div class="itin-time">
                        <div class="itin-lines"></div>
                      </div>

                      <div class="hour-sm">
                        <div class="hour-time-sm">{{ (depart_segment_info['departureDateTime']|date_hours).strftime('%I:%M %p') }}</div>

                        <div class="hour-time-sm">{{ (depart_segment_info['arrivalDateTime']|date_hours).strftime('%I:%M %p') }}</div>
                      </div>
                    </div>

                    <div class="itin-target">
                      <div class="tar-label">{{ search_results['places'][depart_segment_info['originPlaceId']]['iata'] }} {{ search_results['places'][depart_segment_info['originPlaceId']]['name'] }}</div>
                      <div class="tar-label">{{ search_results['places'][depart_segment_info['destinationPlaceId']]['iata'] }} {{ search_results['places'][depart_segment_info['destinationPlaceId']]['name'] }}</div>
                    </div>
                  </div>
                </div>
              </div>
           
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if flight_type == "roundtrip" %}

    <div class="tpd-plan">
      <div class="tp-flight-plan">
        <div class="container-fluid">
          <div class="crop return">
            <div
              class="context context-return collapsed"
              data-bs-toggle="collapse"
              data-bs-target="#demo{{ loop.index }}"
            >
            <a role="button" tabindex="0" class="tog-cal itin-det-btn">
              <i class="bi bi-chevron-up"></i>
              <i class="bi bi-chevron-down"></i>
            </a>

              <div class="item it-2">
                <div class="dr-row">
                  <span class="al-name">
                    {% for carrie in leg2_info["operatingCarrierIds"] %}
                    {{ search_results['carriers'][carrie]['name'] }}{% if not loop.last %} +{% endif %}
                    {% endfor %}
                  </span>
                  {% set return_arrives_in = leg2_info['arrivalDateTime']|date_hours %}
                  <div class="take-tim"><strong>Arrives: </strong>{{ return_arrives_in.strftime('%A, %b %d, %Y') }}</div>
                </div>
              </div>
              <div class="item it-1">
                <div class="route-dot">
                  {% set leg2_stops = (leg2_info['segmentIds']|length) - 1 %}
                  {% for i in range(leg2_stops) %}
                  <span class="point"></span>
                  {% endfor %}
                </div>
                <div class="airline-image">
                  <div class="df-text">{{ leg2_info['durationInMinutes']|to_hours }}</div>
                  <span class="img-wrapper">
                    <svg class="anime-airplane">
                      <use xlink:href="#airplane"></use>
                    </svg>
                    <span class="top-label has-stops"
                    >{% if leg2_stops == 0 %}
                    Direct flight
                    {% elif leg2_stops == 1 %}
                    1 Stop
                    {% else %}
                    {{ leg2_stops }} Stops
                    {% endif %}
                    <span class="stops">{% for segment in leg2_info['segmentIds'][0:-1] %}
                      {{ search_results['places'][search_results['segments'][segment]['destinationPlaceId']]['iata'] }}{% if not loop.last %},{% endif %}
                      {% endfor %}</span>
                    </span>
                  </span>
                </div>

                <div class="port-seg">
                  <div class="flight-seg origin">
                    {% set return_leaves_in = leg2_info['departureDateTime']|date_hours %}
                    <div class="time">{{ return_leaves_in.strftime('%I:%M %p') }}</div>
                    <div class="port">{{ search_results['places'][leg2_info['originPlaceId']]['iata'] }}</div>
                    <div class="name">{{ search_results['places'][leg2_info['originPlaceId']]['name'] }}</div>
                  </div>
                  <div class="flight-seg destination">
                    <div class="time plus">{{ return_arrives_in.strftime('%I:%M %p') }}
                      {% set days = days_difference(leg2_info['departureDateTime']|date, leg2_info['arrivalDateTime']|date ) %}
                      <span>
                      {% if days > 0 %}
                      +{{ days }}
                      {% elif days < 0 %}
                      {{ days }}
                      {% endif %}
                      </span>
                    </div>
                    <div class="port">{{ search_results['places'][leg2_info['destinationPlaceId']]['iata'] }}</div>
                    <div class="name">{{ search_results['places'][leg2_info['destinationPlaceId']]['name'] }}</div>
                  </div>
                </div>
              </div>
            </div>

            <div id="demo{{ loop.index }}" class="fly-wrap collapse">
                
              {% for segment in leg2_info['segmentIds'] %}
              {% set return_segment_info = search_results['segments'][segment] %}
            
              {% if not loop.first %}

              <div class="delay-frame">
  
                <div class="welc"><i class="bi bi-clock"></i>Layover {{ hours_difference(search_results['segments'][leg2_info['segmentIds'][loop.index0 - 1]]['arrivalDateTime']|date_hours, return_segment_info['departureDateTime']|date_hours ) }}</div>
              </div>
  
              {% endif %}

              <div class="fly-det">
              <div class="f-item">
                <div class="airway-title">
                  <img
                    class="airline-logo"
                    src="{{ search_results['carriers'][return_segment_info['operatingCarrierId']]['imageUrl'] }}" onError="this.onerror=null;this.src='';this.parentElement.innerText='{{ search_results['carriers'][return_segment_info['operatingCarrierId']]['name'] }}';" 
                  />
                </div>
                <div class="root-de">
                  <div class="times">{{ return_segment_info['durationInMinutes']|to_hours }}</div>
                  <div class="directs">
                    <div class="itin-time">
                      <div class="itin-lines"></div>
                    </div>

                    <div class="hour-sm">
                      <div class="hour-time-sm">{{ (return_segment_info['departureDateTime']|date_hours).strftime('%I:%M %p') }}</div>

                      <div class="hour-time-sm">{{ (return_segment_info['arrivalDateTime']|date_hours).strftime('%I:%M %p') }}</div>
                    </div>
                  </div>

                  <div class="itin-target">
                    <div class="tar-label">{{ search_results['places'][return_segment_info['originPlaceId']]['iata'] }} {{ search_results['places'][return_segment_info['originPlaceId']]['name'] }}</div>
                    <div class="tar-label">{{ search_results['places'][return_segment_info['destinationPlaceId']]['iata'] }} {{ search_results['places'][return_segment_info['destinationPlaceId']]['name'] }}</div>
                  </div>
                </div>
              </div>
            </div>

            {% endfor %}
          </div>
          </div>
        </div>
      </div>
    </div>
    
    {% endif %}
  
  </div>
</div>

{% endfor %}

<svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" display="none">
  <symbol id="airplane" viewBox="243.5 245.183 25 21.633">
    <g>
      <path
        d="M251.966,266.816h1.242l6.11-8.784l5.711,0.2c2.995-0.102,3.472-2.027,3.472-2.308
                                c0-0.281-0.63-2.184-3.472-2.157l-5.711,0.2l-6.11-8.785h-1.242l1.67,8.983l-6.535,0.229l-2.281-3.28h-0.561v3.566
                                c-0.437,0.257-0.738,0.724-0.757,1.266c-0.02,0.583,0.288,1.101,0.757,1.376v3.563h0.561l2.281-3.279l6.535,0.229L251.966,266.816z
                                "
      />
    </g>
  </symbol>
</svg>

<!-- end document-->
{% endblock %}
